2016-August-05
==============

### sys.setdefault()

- situation, old code was throwing a UnicodeDecode error using a solr library.

- initial investigation...
    - looking through the code, I noticed a file, [sitecustomize.py](https://github.com/birkin/kochief_titles_project/blob/481e93136ba18ba0ccdee7d01af925c2a355cb6d/kochief/pylib/sitecustomize.py) which specified a default encoding of 'utf-8', with a suggestion to move that file to the site-packages directory.
    - i did that, and the solr-commit code worked -- but i didn't want that kind of path-dependency (_so_ easy to forget down the road) -- and i suspected that setdefault() was hiding a problem that should have been more explicitly fixed.
    - my reading indicated that's the case, but it wasn't clear, from a quick perusal of the codebase, whether the problem was in the old newtitles code, or in the old libraries used by the code.

- temporary solution: at the top of the [file being called](https://github.com/birkin/kochief_titles_project/blob/3d96ce1507c841ddf9aa8db23e10b96cebf9a3ec/kochief/discovery/parsers/brown_marc.py#L3-L6)...

        import sys
        if sys.getdefaultencoding() == 'ascii':
            reload(sys)
            sys.setdefaultencoding( 'utf-8' )  # hack; TODO, handle strings & unicode explicitly

---
