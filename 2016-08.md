2016-August-05
==============

### send both bash output, and python output (called by bash) to a log file

- situation: we've seen this with our python rq calls; I came across another usage

- in a bash script, lines like this will send output to the desired log:

        echo "$(date +%Y-%d-%b_%H-%M-%S) - starting nightly script" >> $C_LOG_PATH

    ...but this will not:

        $C_PYTHON_PATH $C_PARSER_PATH $C_UPDATES_DIR_PATH >> $C_LOG_PATH

    ...any output from the python parser-script will output to the terminal

- the solution:

        $C_PYTHON_PATH $C_PARSER_PATH $C_UPDATES_DIR_PATH >> $C_LOG_PATH 2>&1

- great reference, [all about (bash) redirection](http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO-3.html)

---


### sys.setdefault()

- situation, old code was throwing a UnicodeDecode error using a solr library.

- initial investigation...
    - looking through the code, I noticed a file, [sitecustomize.py](https://github.com/birkin/kochief_titles_project/blob/481e93136ba18ba0ccdee7d01af925c2a355cb6d/kochief/pylib/sitecustomize.py) which specified a default encoding of 'utf-8', with a suggestion to move that file to the site-packages directory.
    - i did that, and the solr-commit code worked -- but i didn't want that kind of path-dependency (_so_ easy to forget down the road) -- and i suspected that setdefault() was hiding a problem that should have been more explicitly fixed.
    - my reading indicated that's the case, but it wasn't clear, from a quick perusal of the codebase, whether the problem was in the old newtitles code, or in the old libraries used by the code.

- temporary solution: at the top of the [file being called](https://github.com/birkin/kochief_titles_project/blob/3d96ce1507c841ddf9aa8db23e10b96cebf9a3ec/kochief/discovery/parsers/brown_marc.py#L3-L6)...

        import sys
        if sys.getdefaultencoding() == 'ascii':
            reload(sys)
            sys.setdefaultencoding( 'utf-8' )  # hack; TODO, handle strings & unicode explicitly

---
